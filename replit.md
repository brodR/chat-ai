# Чат Окно - AI Chat Application

## Обзор проекта
Современное веб-приложение для общения с искусственным интеллектом, разработанное 15 ноября 2025 года. Поддерживает текстовые сообщения, мультимедийные файлы (изображения, видео, аудио, документы) и сохраняет полную историю диалогов.

## Текущее состояние
✅ **MVP завершен и протестирован**
- Красивый современный интерфейс с темной/светлой темой
- Полнофункциональная система чата с ИИ
- Загрузка и отображение файлов любых типов
- Сохранение истории в JSON файлах
- Интеграция с OpenAI GPT-5

## Архитектура

### Frontend (React + TypeScript)
- **Framework**: React 18 с Vite
- **UI Library**: Shadcn/ui компоненты + Tailwind CSS
- **Routing**: Wouter (легковесная альтернатива React Router)
- **State Management**: TanStack Query для серверного состояния
- **Styling**: Tailwind CSS с кастомными дизайн-токенами

### Backend (Node.js + Express)
- **Framework**: Express.js
- **File Upload**: Multer для обработки мультимедиа
- **AI Integration**: OpenAI SDK (GPT-5)
- **Storage**: JSON файлы (один файл на разговор)

### Ключевые компоненты
1. **AppSidebar** - боковая панель с навигацией, списком разговоров, настройками
2. **ChatPage** - основная область чата с сообщениями
3. **MessageInput** - ввод сообщений с поддержкой файлов
4. **ChatMessage** - отображение сообщений пользователя и ИИ
5. **SettingsDialog** - выбор модели ИИ

## Структура данных

### Разговор (Conversation)
```typescript
{
  id: string,
  userId?: string,
  title: string,
  model: string, // "gpt-5", "gpt-4o", etc.
  createdAt: Date,
  updatedAt: Date
}
```

### Сообщение (Message)
```typescript
{
  id: string,
  conversationId: string,
  role: "user" | "assistant",
  content: string,
  files?: FileAttachment[],
  timestamp: Date
}
```

### Файл (FileAttachment)
```typescript
{
  id: string,
  name: string,
  type: string,
  size: number,
  url: string,
  mimeType?: string
}
```

## API Endpoints

### Разговоры
- `GET /api/conversations` - получить все разговоры
- `POST /api/conversations` - создать новый разговор
- `GET /api/conversations/:id` - получить конкретный разговор
- `DELETE /api/conversations/:id` - удалить разговор

### Сообщения
- `GET /api/conversations/:conversationId/messages` - получить сообщения разговора
- `POST /api/messages` - отправить сообщение (с файлами)

## Хранилище данных

### JSON файлы
Каждый разговор хранится в отдельном JSON файле:
- Путь: `data/conversations/{conversationId}.json`
- Структура: `{ conversation: Conversation, messages: Message[] }`

### Загруженные файлы
- Путь: `uploads/`
- Формат имени: `{uuid}-{originalname}`
- Доступ: `/uploads/{filename}`

## Настройка

### Переменные окружения
- `OPENAI_API_KEY` - ключ для OpenAI API (обязательно для работы ИИ)
- `PORT` - порт сервера (по умолчанию 5000)
- `SESSION_SECRET` - секрет для сессий

### Установка API ключа
1. Зарегистрируйтесь на https://platform.openai.com
2. Создайте API ключ в разделе API Keys
3. Добавьте в Secrets: `OPENAI_API_KEY=your-key-here`

## Особенности реализации

### Дизайн
- Следует руководству `design_guidelines.md`
- Использует шрифт Inter для интерфейса
- Поддержка темной и светлой темы
- Адаптивный дизайн для мобильных устройств

### Безопасность
- Файлы ограничены до 50MB
- Поддерживаемые типы: изображения, видео, аудио, документы
- Валидация данных с помощью Zod схем
- Безопасное хранение API ключей в переменных окружения

### Производительность
- Автоматическая прокрутка к новым сообщениям
- Оптимистичные обновления UI
- Кэширование запросов с TanStack Query
- Ленивая загрузка компонентов

## Недавние изменения (15.11.2025)
- ✅ Реализован полный MVP
- ✅ Добавлена поддержка файлов всех типов
- ✅ Интеграция с OpenAI GPT-5
- ✅ Система сохранения в JSON
- ✅ Темная/светлая тема
- ✅ Настройки выбора модели
- ✅ End-to-end тестирование

## Пользовательские предпочтения
- Язык интерфейса: Русский
- Стиль дизайна: Современный, минималистичный (как ChatGPT)
- Хранилище: JSON файлы (по требованию пользователя)

## Следующие шаги (Next Phase)
- [ ] Добавить streaming ответов от ИИ
- [ ] Поддержка локальных моделей
- [ ] Поиск по истории разговоров
- [ ] Экспорт разговоров
- [ ] Анализ изображений с помощью GPT-5 Vision
- [ ] Транскрипция аудио с Whisper
- [ ] Множественные пользователи с аутентификацией

## Технические детали

### Обработка дат
- Даты сохраняются как ISO строки в JSON
- При загрузке конвертируются обратно в Date объекты
- Временные метки отображаются в формате HH:MM

### Заголовки разговоров
- Автоматически генерируются из первого сообщения
- Обрезаются до 50 символов с "..."
- Можно будет редактировать в будущем

### Ответы ИИ
- Используется модель GPT-5 по умолчанию
- Без ключа показывается информативное сообщение
- История разговора передается для контекста
- Поддержка переключения между моделями
